<div class="row">
  <div class="col-md-3 text-center">
    <%= image_tag avatar_url(@other), class: "imag-circle avatar-medium"%><br>
    <strong><%= @other.fullname %></strong>
    <%= link_to "View Profile", @other, class: "btn btn-default wide"%>
  </div>
  <div class="col-md-9">
    <div class="panel panel-default">
      <div class="panel-heading">
        Conversation with <%= @other.fullname %>
      </div>
      <div class="panel-body">
        <div class="container">

          <%= form_for [@conversation, @conversation.messages.new] do |f| %>
            <div class="form-group">
              <%= f.text_area :content, id: 'new_message', placeholder: "Add a personal message", class: "form-control" %>
            </div>
            <%= f.hidden_field :user_id, value: current_user.id %>

            <div class="actions">
              <%= f.submit "Send Message", class: "btn btn-primary", autocomplete:"off"%>
            </div>
          <% end %>

        </div>
      </div>
    </div>

    <div id="chat">
      <%= render 'messages' %>
    </div>
  </div>
</div>
<script type="text/javascript" charset="utf-8">
  $(function() {
    $('[data-disable-with]').removeAttr('data-disable-with')
    $('form').submit(function(e){
      e.preventDefault();

      var values = $(this).serialize();
      var posting = $.post(this.action, values);

      posting.done(function(data) {
        console.log(data);
        var newMsg = new Message()
        $('textarea').val('')
        var messageBox = ""
        messageBox += '<div class="panel">'
        messageBox +=   '<div class="panel-body">'
        messageBox +=      '<img src="'+ data.user.image + '"' + ' class="img-circle avatar-small">'
        messageBox +=          '<strong>' + data.user.fullname + '</strong>'
        messageBox +=            '<span class="pull-right">' + data.created_at + '</span>'
        messageBox +=           '<br>'
        messageBox +=           '<div class="row-space-2">' + data.content + '</div></div></div>'
        $('#chat').first().prepend(messageBox)

      })
    })
  })
</script>
